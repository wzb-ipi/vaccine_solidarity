list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*20 + (deal==2 | deal == 4)*40,
others_giving = (deal==1 | deal == 2)*20 + (deal==3 | deal == 4)*40,
cash = cash - mean(cash),
doses = doses - mean(doses),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
lm_robust(cash ~ trading_importance+risk+others_number + others_giving, fixed_effects = ~id,  se_type = "stata", data = df)
lm_robust(cash ~ trading_importance+risk+others_number + others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df)
lm_robust(doses ~ trading_importance+risk+others_number + others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df)
lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df)
main_results <-
list(
cash = lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy,
doses = lm_robust(doses ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy) %>% bind_rows()
main_results
head(main_results)
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of other giving", "Amount given by others")
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of other giving", "Amount given by others")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatment_levels, treatment_labels)) %>%
ggplot(aes(Treatment, estimate)) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1)+
geom_hline(yintercept=0, linetype="longdash", lwd=0.35, size=0.75, colour = "#B55555") +
theme_bw(base_size=14) + facet_grid(~outcome)
ylab("Estimated effect on prob vaccination (0-1)") + theme(legend.position="bottom")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(Treatment, estimate)) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1)+
geom_hline(yintercept=0, linetype="longdash", lwd=0.35, size=0.75, colour = "#B55555") +
theme_bw(base_size=14) + facet_grid(~outcome)
ylab("Estimated effect on prob vaccination (0-1)") + theme(legend.position="bottom")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(Treatment, estimate)) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1)+
geom_hline(yintercept=0, linetype="longdash", lwd=0.35, size=0.75, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)
ylab("Estimated effect on prob vaccination (0-1)") + theme(legend.position="bottom")
figure_1A
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(Treatment, estimate)) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1)+
geom_hline(yintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("Estimated effect on prob vaccination (0-1)") + theme(legend.position="bottom")
figure_1A
figure_1
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) +
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("")
figure_1
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("")
figure_1
df <-
list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*2 + (deal==2 | deal == 4)*4,
others_giving = (deal==1 | deal == 2)*2 + (deal==3 | deal == 4)*4,
cash = cash - mean(cash),
doses = doses - mean(doses),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
main_results <-
list(
cash = lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy,
doses = lm_robust(doses ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy) %>% bind_rows()
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of others giving (10s)", "Amount given by others\n(10s of billions)")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("")
figure_1
df %>%
ggplot(aes(cash, risk)) + geom_point()
df %>%
ggplot(aes(risk, cash)) + geom_point()
vign_values
df %>%
ggplot(aes(risk, cash)) + +
geom_boxplot()
df %>%
ggplot(aes(risk, cash)) +
geom_boxplot()
df %>%
ggplot(aes(factor(risk), cash)) +
geom_boxplot()
hist(df$cash)
df <-
list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*2 + (deal==2 | deal == 4)*4,
others_giving = (deal==1 | deal == 2)*2 + (deal==3 | deal == 4)*4,
risk = risk - mean(risk),
trading_importance = trading_importance - mean(trading_importance),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
main_results <-
list(
cash = lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy,
doses = lm_robust(doses ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy) %>% bind_rows()
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of others giving (10s)", "Amount given by others\n(10s of billions)")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("")
figure_1
main_results
main_results
figure_2 <-
df %>%
ggplot(aes(factor(risk), cash)) +
geom_boxplot()
figure_2
lm_robust(cash ~ risj, data = df)
lm_robust(cash ~ risk, data = df)
lm_robust(doses ~ risk, data = df)
figure_3 <-
df %>%
ggplot(aes(factor(risk), doses)) +
geom_boxplot()
figure_3
df <-
list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*2 + (deal==2 | deal == 4)*4,
others_giving = (deal==1 | deal == 2)*2 + (deal==3 | deal == 4)*4,
risk_factor = factor(risk, 0:1, c("Low", "High")),
risk = risk - mean(risk),
trading_importance = trading_importance - mean(trading_importance),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
main_results <-
list(
cash = lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy,
doses = lm_robust(doses ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy) %>% bind_rows()
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of others giving (10s)", "Amount given by others\n(10s of billions)")
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome)+
ylab("")
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot()
figure_3 <-
df %>%
ggplot(aes(risk_factor, doses)) +
geom_boxplot()
figure_1
figure_2
figure_3 <-
df %>%
ggplot(aes(risk_factor, doses)) +
geom_boxplot() + xlab("")
figure_3
figure_3 <-
df %>%
ggplot(aes(risk_factor, doses)) +
geom_boxplot() + xlab("") + ylab("Millions of doses")
figure_3
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")
figure_2
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk") + scales::pseudo_log_trans()
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt()
figure_2
mean(df$cash, na.rm = TRUE)
mean(df$doses, na.rm = TRUE)
kable(main_results, digits = 2)
main_results %>%
kbl(digit =2) %>%
kable_material(c("striped", "hover"))
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome, scales = "free_x")+
ylab("")
figure_1
df %>%
ggplot(aes(cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt() +
fact_grid(risk ~ trading_importance)
df %>%
ggplot(aes(cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt() +
facet_grid(risk ~ trading_importance)
figure_4 <-
df %>%
ggplot(aes(cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt() +
facet_grid(risk_factor ~ trading_importance)
figure_4
df %>%
ggplot(aes(cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_x_sqrt() +
facet_grid(risk_factor ~ trading_importance)
lm_robust(cash trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy
lm_robust(cash ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy
df <-
list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*2 + (deal==2 | deal == 4)*4,
others_giving = (deal==1 | deal == 2)*2 + (deal==3 | deal == 4)*4,
risk_factor = factor(risk, 0:1, c("Low", "High")),
trading_factor = factor(trading_importance, 0:1, c("Low", "High")),
risk = risk - mean(risk),
trading_importance = trading_importance - mean(trading_importance),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
lm_robust(cash ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy
lm_robust(log(cash) ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy
lm_robust(log(cash+1) ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy
round(median(df$cash, na.rm = TRUE)
, 2)
round(median(df$doses, na.rm = TRUE), 2)
df_mean <- df %>%
group_by(risk_factor) %>%
summarize(average = mean(cash, na.rm = TRUE)) %>%
ungroup()
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt() +
geom_point(data = df_mean,
mapping = aes(x = risk_factor, y = average),
color="red")
figure_2
12/40
2/9
2/9
3/10
4/11
5/12
12/40
14/42
16/44
18/46
5/11
4/11
5/12
4/11
# Chunk 1: setup
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, comment=NA)
options(qwraps2_markup = "markdown")
## Packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(
ggridges,    # plot
cregg,       # conjoint
readxl,      # read excel
gtrendsR,    # google trends
aod,         # hypothesis testing (1.3.1)
car,         # linear hypothesis testing for causal tree (3.0-2)
corrplot,    # Correlations (0.84)
DeclareDesign,
dplyr,       # Data manipulation (0.8.0.1)
evtree,      # evolutionary learning of globally optimal trees (1.0-7)
fastDummies,
fBasics,     # Summary statistics (3042.89)
ggplot2,
grf,         # Generalized random forests (0.10.2)
haven,       # load sav
kableExtra,  # Prettier RMarkdown (1.0.1)
knitr,
labelled,
psych,       # Correlation p-values (1.8.12)
purrr,
rpart,       # Classification and regression trees, or CART (4.1-13)
reshape2,
rpart.plot,  # Plotting trees (3.0.6)
readr,       # Reading csv files (1.3.1)
sjlabelled,
stats,
summarytools,
texreg,
tidyverse,
tidyselect,
tidyr,       # Database operations (0.8.3)
treeClust,   # Predicting leaf position for causal trees (1.1-7)
tibble)      # Modern alternative to data frames (2.1.1)
# Set seed for reproducibility
set.seed(201911)
# Paths
# datapath <- "../../../4_data/wave_2/D-P21-13185 HU Berlin Impfskeptiker_Welle 2_Testdatensatz.sav"
# First Wave: to get the covariates
firstwave <- "../../../4_data/wave_1/D-P21-13185 HU Berlin Impfskeptiker_Finaler_Datensatz.sav"
datapath <- "../../../4_data/wave_2/D-P21-13185 HU Berlin Impfskeptiker_Welle 2_Finaler_Datensatz.sav"
vignettepath <- "../../../4_data/wave_2/W2_exp3_vignettes_universe.dta"
# data from the 9th of September
fourthwave <- "1_input/D-P21-13185 HU Berlin Impfskeptiker_Welle 4_Finaler_Datensatz---Combined"
vignettepath_7 <- "1_input/W4_exp7_vignettes_universe_-_20210831.dta"
# variable names and labels
var_list_1<- read.csv("1_input/varsfirstwave.csv") %>% arrange(order)
var_list_2 <- read.csv("1_input/varssecondwave.csv") %>% arrange(order)
var_list<-rbind(var_list_1,var_list_2)
outcomes <- c("solidarity_bahaviour", "solidarity_attitude")
outcome_labels <- c("Solidarity Bahaviour", "Solidarity Attitude")
treatments <- c("treatment_video")
treatment_labels <- c("Treatment")
# Chunk 2
covariate_names_1 <- var_list_1$new_name[var_list_1$covariate==1]
covariate_names_2 <- var_list_2$new_name[var_list_2$covariate==1]
# Chunk 3
# w4 <- haven::read_dta(fourthwave)
w4 <- haven::read_sav(fourthwave)
labs <- var_label(w4) %>% unlist
# data.frame(names(labs), labs) %>% kable()
# View(w4)
vign_values <- read_dta("1_input/W4_exp8_vignettes_universe_-_20210825.dta")
df <-
list(
w4 %>%
mutate(vignr = as.numeric(c_0037)) %>% left_join(vign_values) %>%
mutate(round = 1,
cash = 	exp7_money1,
doses = exp7_doses1) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal),
w4 %>%
mutate(vignr = as.numeric(c_0038)) %>% left_join(vign_values) %>%
mutate(round = 2,
cash = 	exp7_money2,
doses = exp7_doses2) %>%
select(group, lfdn, round, cash, doses, trading_importance, risk, deal)) %>%
bind_rows %>%
dplyr::filter(group !=4) %>%
mutate(id = paste(lfdn, group),
others_number = (deal==1 | deal == 3)*2 + (deal==2 | deal == 4)*4,
others_giving = (deal==1 | deal == 2)*2 + (deal==3 | deal == 4)*4,
risk_factor = factor(risk, 0:1, c("Low", "High")),
trading_factor = factor(trading_importance, 0:1, c("Low", "High")),
risk = risk - mean(risk),
trading_importance = trading_importance - mean(trading_importance),
others_number = others_number - mean(others_number),
others_giving =others_giving - mean(others_giving))
main_results <-
list(
cash = lm_robust(cash ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy,
doses = lm_robust(doses ~ trading_importance*risk*others_number*others_giving  + round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy) %>% bind_rows()
treatments <- c("trading_importance", "risk", "others_number", "others_giving")
treatment_labels <- c("Trading importance", "Risk", "Number of others giving (10s)", "Amount given by others\n(10s of billions)")
# Chunk 4
figure_1 <-
main_results %>%
dplyr::filter(term %in% treatments) %>%
mutate(Treatment = factor(term, treatments, treatment_labels)) %>%
ggplot(aes(estimate, Treatment)) + geom_point()+
geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = .1)+
geom_vline(xintercept=0, linetype="longdash", lwd=0.35, colour = "#B55555") +
theme_bw() + facet_grid(~outcome, scales = "free_x")+
ylab("")
df_mean <- df %>%
group_by(risk_factor) %>%
summarize(average = mean(cash, na.rm = TRUE)) %>%
ungroup()
figure_2 <-
df %>%
ggplot(aes(risk_factor, cash)) +
geom_boxplot() + ylab("Billions of Euros")   + xlab("Risk")  + scale_y_sqrt() +
geom_point(data = df_mean,
mapping = aes(x = risk_factor, y = average),
color="red")
figure_3 <-
df %>%
ggplot(aes(risk_factor, doses)) +
geom_boxplot() + ylab("Millions of doses") + xlab("Risk")
figure_2
figure_3
# Chunk 5
figure_1
# Chunk 6
lm_robust(cash ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy  %>%
kbl(digit =2) %>%
kable_minimal()
# Chunk 7
lm_robust(log(cash+1) ~ trading_factor*risk_factor+ round, fixed_effects = ~id,  se_type = "stata", data = df) %>% tidy  %>%
kbl(digit =2) %>%
kable_minimal()
# Chunk 8
main_results %>%
kbl(digit =2) %>%
kable_minimal()
# Chunk 9
save.image("Solidarity.Rdata")
load("Solidarity.Rdata")
